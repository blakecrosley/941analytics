{# Technology tab content - device/browser/OS breakdown #}

{% include "components/date_picker.html" %}

{% include "components/stats_cards.html" %}

<div class="grid-3">
    {# Devices #}
    <div class="section">
        <div class="section__header">
            <span class="section__title">Devices</span>
        </div>
        <div class="section__content section__content--flush">
            {% if devices|length > 0 %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th class="text-right">Visits</th>
                        <th class="text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for device in devices %}
                    <tr>
                        <td>
                            <a href="?device={{ device.device_type }}"
                               hx-get="./partials/technology?device={{ device.device_type }}"
                               hx-target="#main-content"
                               hx-push-url="?device={{ device.device_type }}"
                               style="text-decoration: none; color: var(--muted);">
                                {% if device.device_type == 'desktop' %}üíª{% elif device.device_type == 'mobile' %}üì±{% else %}üìü{% endif %}
                                {{ device.device_type|capitalize }}
                            </a>
                            <div class="table__bar">
                                <div class="table__bar-fill" style="width: {{ device.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td class="text-right table__number">{{ "{:,}".format(device.visits) }}</td>
                        <td class="text-right table__number">{{ "{:.1f}".format(device.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">
                <div class="empty__icon">üì±</div>
                <p>No device data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Browsers #}
    <div class="section">
        <div class="section__header">
            <span class="section__title">Browsers</span>
        </div>
        <div class="section__content section__content--flush">
            {% if browsers|length > 0 %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Browser</th>
                        <th class="text-right">Visits</th>
                        <th class="text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for browser in browsers[:10] %}
                    <tr>
                        <td>
                            <a href="?browser={{ browser.browser|urlencode }}"
                               hx-get="./partials/technology?browser={{ browser.browser|urlencode }}"
                               hx-target="#main-content"
                               hx-push-url="?browser={{ browser.browser|urlencode }}"
                               style="text-decoration: none; color: var(--muted);">
                                {{ browser.browser }}
                            </a>
                            <div class="table__bar">
                                <div class="table__bar-fill" style="width: {{ browser.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td class="text-right table__number">{{ "{:,}".format(browser.visits) }}</td>
                        <td class="text-right table__number">{{ "{:.1f}".format(browser.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">
                <div class="empty__icon">üåê</div>
                <p>No browser data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Operating Systems #}
    <div class="section">
        <div class="section__header">
            <span class="section__title">Operating Systems</span>
        </div>
        <div class="section__content section__content--flush">
            {% if operating_systems|length > 0 %}
            {% set total_os = operating_systems|map(attribute='visits')|sum %}
            <table class="table">
                <thead>
                    <tr>
                        <th>OS</th>
                        <th class="text-right">Visits</th>
                        <th class="text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for os in operating_systems[:10] %}
                    <tr>
                        <td>
                            <a href="?os={{ os.os|urlencode }}"
                               hx-get="./partials/technology?os={{ os.os|urlencode }}"
                               hx-target="#main-content"
                               hx-push-url="?os={{ os.os|urlencode }}"
                               style="text-decoration: none; color: var(--muted);">
                                {% if 'Windows' in os.os %}ü™ü{% elif 'Mac' in os.os or 'iOS' in os.os %}üçé{% elif 'Android' in os.os %}ü§ñ{% elif 'Linux' in os.os %}üêß{% else %}üíª{% endif %}
                                {{ os.os }}
                            </a>
                            <div class="table__bar">
                                <div class="table__bar-fill" style="width: {{ (os.visits / total_os * 100)|int }}%;"></div>
                            </div>
                        </td>
                        <td class="text-right table__number">{{ "{:,}".format(os.visits) }}</td>
                        <td class="text-right table__number">{{ "{:.1f}".format(os.visits / total_os * 100) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">
                <div class="empty__icon">üñ•Ô∏è</div>
                <p>No OS data</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="grid-2">
    {# Screen Sizes #}
    <div class="section">
        <div class="section__header">
            <span class="section__title">Screen Sizes</span>
        </div>
        <div class="section__content section__content--flush">
            {% if screen_sizes|length > 0 %}
            {% set total_screens = screen_sizes|map(attribute='visits')|sum %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Resolution</th>
                        <th class="text-right">Visits</th>
                        <th class="text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for screen in screen_sizes[:10] %}
                    <tr>
                        <td>
                            {{ screen.resolution }}
                            <div class="table__bar">
                                <div class="table__bar-fill" style="width: {{ (screen.visits / total_screens * 100)|int }}%;"></div>
                            </div>
                        </td>
                        <td class="text-right table__number">{{ "{:,}".format(screen.visits) }}</td>
                        <td class="text-right table__number">{{ "{:.1f}".format(screen.visits / total_screens * 100) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">
                <div class="empty__icon">üìê</div>
                <p>No screen size data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Languages #}
    <div class="section">
        <div class="section__header">
            <span class="section__title">Languages</span>
        </div>
        <div class="section__content section__content--flush">
            {% if languages|length > 0 %}
            {% set total_langs = languages|map(attribute='visits')|sum %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Language</th>
                        <th class="text-right">Visits</th>
                        <th class="text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lang in languages[:10] %}
                    <tr>
                        <td>
                            {{ lang.language }}
                            <div class="table__bar">
                                <div class="table__bar-fill" style="width: {{ (lang.visits / total_langs * 100)|int }}%;"></div>
                            </div>
                        </td>
                        <td class="text-right table__number">{{ "{:,}".format(lang.visits) }}</td>
                        <td class="text-right table__number">{{ "{:.1f}".format(lang.visits / total_langs * 100) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">
                <div class="empty__icon">üåç</div>
                <p>No language data</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
