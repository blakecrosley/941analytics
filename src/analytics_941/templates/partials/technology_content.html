{# Technology tab content - device/browser/OS breakdown #}
{# Layout: Primary (controls + KPIs) ‚Üí Secondary (tech breakdown) #}

{# ===== PRIMARY ZONE: Controls & KPIs ===== #}
<div class="analytics-zone-primary">
    {% include "components/date_picker.html" %}

    {% include "components/stats_cards.html" %}
</div>

{# ===== SECONDARY ZONE: Technology Breakdown ===== #}
<div class="analytics-zone-secondary">
<div class="analytics-grid-3">
    {# Devices #}
    <div class="analytics-section">
        <div class="analytics-section__header">
            <span class="analytics-section__title">Devices</span>
        </div>
        <div class="analytics-section__content analytics-section__content--flush">
            {% if devices|length > 0 %}
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Device</th>
                        <th class="analytics-text-right">Visits</th>
                        <th class="analytics-text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for device in devices %}
                    <tr>
                        <td>
                            <a href="?device={{ device.device_type }}"
                               hx-get="./partials/technology?device={{ device.device_type }}"
                               hx-target="#main-content"
                               hx-push-url="?device={{ device.device_type }}"
                               style="text-decoration: none; color: var(--941-color-text-muted);">
                                {% if device.device_type == 'desktop' %}üíª{% elif device.device_type == 'mobile' %}üì±{% else %}üìü{% endif %}
                                {{ device.device_type|capitalize }}
                            </a>
                            <div class="analytics-table__bar">
                                <div class="analytics-table__bar-fill" style="width: {{ device.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:,}".format(device.visits) }}</td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:.1f}".format(device.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="analytics-empty">
                <div class="analytics-empty__icon">üì±</div>
                <p>No device data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Browsers #}
    <div class="analytics-section">
        <div class="analytics-section__header">
            <span class="analytics-section__title">Browsers</span>
        </div>
        <div class="analytics-section__content analytics-section__content--flush">
            {% if browsers|length > 0 %}
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Browser</th>
                        <th class="analytics-text-right">Visits</th>
                        <th class="analytics-text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for browser in browsers[:10] %}
                    <tr>
                        <td>
                            <a href="?browser={{ browser.browser|urlencode }}"
                               hx-get="./partials/technology?browser={{ browser.browser|urlencode }}"
                               hx-target="#main-content"
                               hx-push-url="?browser={{ browser.browser|urlencode }}"
                               style="text-decoration: none; color: var(--941-color-text-muted);">
                                {{ browser.browser }}
                            </a>
                            <div class="analytics-table__bar">
                                <div class="analytics-table__bar-fill" style="width: {{ browser.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:,}".format(browser.visits) }}</td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:.1f}".format(browser.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="analytics-empty">
                <div class="analytics-empty__icon">üåê</div>
                <p>No browser data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Operating Systems #}
    <div class="analytics-section">
        <div class="analytics-section__header">
            <span class="analytics-section__title">Operating Systems</span>
        </div>
        <div class="analytics-section__content analytics-section__content--flush">
            {% if operating_systems|length > 0 %}
            {% set total_os = operating_systems|map(attribute='visits')|sum %}
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>OS</th>
                        <th class="analytics-text-right">Visits</th>
                        <th class="analytics-text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for os in operating_systems[:10] %}
                    <tr>
                        <td>
                            <a href="?os={{ os.os|urlencode }}"
                               hx-get="./partials/technology?os={{ os.os|urlencode }}"
                               hx-target="#main-content"
                               hx-push-url="?os={{ os.os|urlencode }}"
                               style="text-decoration: none; color: var(--941-color-text-muted);">
                                {% if 'Windows' in os.os %}ü™ü{% elif 'Mac' in os.os or 'iOS' in os.os %}üçé{% elif 'Android' in os.os %}ü§ñ{% elif 'Linux' in os.os %}üêß{% else %}üíª{% endif %}
                                {{ os.os }}
                            </a>
                            <div class="analytics-table__bar">
                                <div class="analytics-table__bar-fill" style="width: {{ (os.visits / total_os * 100)|int }}%;"></div>
                            </div>
                        </td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:,}".format(os.visits) }}</td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:.1f}".format(os.visits / total_os * 100) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="analytics-empty">
                <div class="analytics-empty__icon">üñ•Ô∏è</div>
                <p>No OS data</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="analytics-grid-2">
    {# Screen Sizes - Enhanced with Breakpoint Summary #}
    <div class="analytics-section">
        <div class="analytics-section__header">
            <span class="analytics-section__title">Screen Sizes</span>
        </div>
        <div class="analytics-section__content">
            {# Breakpoint Summary Bars #}
            {% if screen_breakpoints|length > 0 %}
            <div class="analytics-breakpoints">
                {% for bp in screen_breakpoints %}
                <div class="analytics-breakpoint">
                    <div class="analytics-breakpoint__label">{{ bp.label }}</div>
                    <div class="analytics-breakpoint__bar">
                        <div class="analytics-breakpoint__fill analytics-breakpoint__fill--{{ bp.breakpoint }}" style="width: {{ bp.percentage }}%;"></div>
                    </div>
                    <div class="analytics-breakpoint__value">{{ "{:.1f}".format(bp.percentage) }}%</div>
                </div>
                {% endfor %}
            </div>
            <hr class="analytics-divider">
            {% endif %}

            {# Detailed Resolution Table #}
            {% if screen_sizes|length > 0 %}
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Resolution</th>
                        <th>Type</th>
                        <th class="analytics-text-right">Visits</th>
                        <th class="analytics-text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for screen in screen_sizes[:10] %}
                    <tr>
                        <td>
                            {{ screen.resolution }}
                            <div class="analytics-table__bar">
                                <div class="analytics-table__bar-fill" style="width: {{ screen.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td>
                            <span class="analytics-badge analytics-badge--{{ screen.breakpoint }}">
                                {{ screen.breakpoint|capitalize }}
                            </span>
                        </td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:,}".format(screen.visits) }}</td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:.1f}".format(screen.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="analytics-empty">
                <div class="analytics-empty__icon">üìê</div>
                <p>No screen size data</p>
            </div>
            {% endif %}
        </div>
    </div>

    {# Languages - Enhanced with Human-Readable Names #}
    <div class="analytics-section">
        <div class="analytics-section__header">
            <span class="analytics-section__title">Languages</span>
        </div>
        <div class="analytics-section__content analytics-section__content--flush">
            {% if languages|length > 0 %}
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Language</th>
                        <th class="analytics-text-right">Visits</th>
                        <th class="analytics-text-right">%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lang in languages[:10] %}
                    <tr>
                        <td>
                            <a href="?language={{ lang.code|urlencode }}"
                               hx-get="./partials/technology?language={{ lang.code|urlencode }}"
                               hx-target="#main-content"
                               hx-push-url="?language={{ lang.code|urlencode }}"
                               style="text-decoration: none; color: var(--941-color-text-muted);">
                                {{ lang.name }}
                                <br>
                                <small class="analytics-text-muted">{{ lang.code }}</small>
                            </a>
                            <div class="analytics-table__bar">
                                <div class="analytics-table__bar-fill" style="width: {{ lang.percentage|int }}%;"></div>
                            </div>
                        </td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:,}".format(lang.visits) }}</td>
                        <td class="analytics-text-right analytics-table__number">{{ "{:.1f}".format(lang.percentage) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="analytics-empty">
                <div class="analytics-empty__icon">üåç</div>
                <p>No language data</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
</div>{# End analytics-zone-secondary #}
